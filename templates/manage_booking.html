{% extends "base.html" %}

{% block title %}예약 관리{% endblock %}

{% block content %}
<div class="card p-5 shadow-sm border-0 coffee-card">
  <div class="text-center mb-4">
    <h2 class="mb-3">☕ 예약 관리</h2>
  </div>

  <div class="booking-info">
    <h5 class="mb-3">예약 정보</h5>

    <div class="info-row">
      <span class="label">이름:</span>
      <span class="value">{{ booking.name }}</span>
    </div>

    <div class="info-row">
      <span class="label">이메일:</span>
      <span class="value">{{ booking.email }}</span>
    </div>

    <div class="info-row">
      <span class="label">전화번호:</span>
      <span class="value">{{ booking.phone or 'N/A' }}</span>
    </div>

    <div class="info-row">
      <span class="label">대화 주제:</span>
      <span class="value">{{ booking.purpose or 'N/A' }}</span>
    </div>

    <div class="info-row">
      <span class="label">선택 시간:</span>
      <span class="value">{{ booking.selected_slot }}</span>
    </div>

    <div class="info-row">
      <span class="label">상태:</span>
      <span class="value">
        {% if booking.status == 'confirmed' %}
          <span class="badge bg-success">✅ 승인됨</span>
        {% elif booking.status == 'cancelled' %}
          <span class="badge bg-secondary">❌ 취소됨</span>
        {% else %}
          <span class="badge bg-warning text-dark">⏳ 대기 중</span>
        {% endif %}
      </span>
    </div>

    {% if booking.status == 'confirmed' and booking.meet_link %}
    <div class="info-row">
      <span class="label">Meet 링크:</span>
      <span class="value">
        <a href="{{ booking.meet_link }}" target="_blank" class="btn btn-sm btn-primary">
          🔗 Google Meet 참여하기
        </a>
      </span>
    </div>
    {% endif %}

    {% if booking.confirmed_at %}
    <div class="info-row">
      <span class="label">승인 시각:</span>
      <span class="value">{{ booking.confirmed_at }}</span>
    </div>
    {% endif %}
  </div>

  {% if booking.status == 'confirmed' %}
  <div class="mt-4">
    <h5 class="mb-3">예약 수정/취소</h5>
    <p class="text-muted small">
      예약을 변경하거나 취소할 수 있습니다.
    </p>

    <div class="d-grid gap-2">
      <a href="/manage/{{ booking.cancel_token }}/change" class="btn coffee-btn-outline">
        🔄 예약 시간 변경
      </a>

      <form method="POST" action="/manage/{{ booking.cancel_token }}/cancel"
            onsubmit="return confirm('정말로 예약을 취소하시겠습니까? 이 작업은 되돌릴 수 없습니다.');">
        <button type="submit" class="btn btn-danger w-100">
          ❌ 예약 취소
        </button>
      </form>
    </div>
  </div>
  {% elif booking.status == 'cancelled' %}
  <div class="alert alert-secondary mt-4">
    <strong>📌 예약이 취소되었습니다</strong><br>
    취소된 예약은 복구할 수 없습니다.
  </div>
  {% else %}
  <div class="alert alert-info mt-4">
    <strong>📌 대기 중입니다</strong><br>
    관리자가 예약을 승인하면 이메일로 알려드립니다.
  </div>
  {% endif %}

  <a href="/" class="btn coffee-btn w-100 mt-3">홈으로 돌아가기</a>
</div>
{% endblock %}

{% block script %}
<style>
  body {
    background-color: #f3ede7;
    font-family: 'Inter', sans-serif;
    color: #5e4634;
  }

  .coffee-card {
    background-color: #fffdfc;
    border-radius: 1rem;
    max-width: 600px;
    margin: 2rem auto;
  }

  .booking-info {
    background-color: #f9f7f5;
    padding: 1.5rem;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
  }

  .info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #e5e0da;
  }

  .info-row:last-child {
    border-bottom: none;
  }

  .label {
    font-weight: 600;
    color: #6b4c3b;
    flex-shrink: 0;
    margin-right: 1rem;
  }

  .value {
    text-align: right;
    color: #5e4634;
    word-break: break-word;
  }

  .coffee-btn {
    background-color: #6b4c3b;
    color: white;
    border: 1px solid #6b4c3b;
    transition: all 0.2s ease-in-out;
  }

  .coffee-btn:hover {
    background-color: #f3ede7;
    color: #6b4c3b;
    border: 1px solid #6b4c3b;
  }

  .coffee-btn-outline {
    background-color: transparent;
    color: #6b4c3b;
    border: 1px solid #6b4c3b;
    transition: all 0.2s ease-in-out;
  }

  .coffee-btn-outline:hover {
    background-color: #6b4c3b;
    color: white;
  }

  .badge {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }

  .alert-info {
    background-color: #e8f4f8;
    border-color: #b3d9e6;
    color: #31708f;
  }

  .alert-secondary {
    background-color: #f5f5f5;
    border-color: #ddd;
    color: #666;
  }
</style>
{% endblock %}
