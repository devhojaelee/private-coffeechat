{% extends "base.html" %}

{% block title %}{{ link_name }} - ì»¤í”¼ì±— ì˜ˆì•½{% endblock %}

{% block progress %}
<div class="progress-stepper" data-current-step="1" role="navigation" aria-label="ì˜ˆì•½ ì§„í–‰ ë‹¨ê³„">
  <div class="progress-step active">
    <div class="step-circle" aria-current="step">1</div>
    <div class="step-label">ì •ë³´ì…ë ¥</div>
  </div>
  <span class="step-arrow" aria-hidden="true">â†’</span>
  <div class="progress-step">
    <div class="step-circle">2</div>
    <div class="step-label">ì´ë©”ì¼ì¸ì¦</div>
  </div>
  <span class="step-arrow" aria-hidden="true">â†’</span>
  <div class="progress-step">
    <div class="step-circle">3</div>
    <div class="step-label">ì‹œê°„ì„ íƒ</div>
  </div>
  <span class="step-arrow" aria-hidden="true">â†’</span>
  <div class="progress-step">
    <div class="step-circle">4</div>
    <div class="step-label">ì™„ë£Œ</div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="card p-5 shadow-sm border-0 coffee-card">
  <h2 class="mb-4 text-center">â˜• {{ link_name }}</h2>

  <!-- ğŸ†• ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ -->
  <div class="alert alert-warning text-center mb-4" id="timer-alert">
    <strong>â° ë‚¨ì€ ì‹œê°„: <span id="countdown">ê³„ì‚° ì¤‘...</span></strong>
  </div>

  <p class="text-center text-muted mb-4">
    ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ì´ë©”ì¼ ì¸ì¦ í›„<br>
    ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </p>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <form method="post">
    <div class="mb-3">
      <label class="form-label">ì´ë¦„ *</label>
      <input type="text" name="name" class="form-control" placeholder="í™ê¸¸ë™" required>
    </div>

    <div class="mb-3">
      <label class="form-label">ì´ë©”ì¼ *</label>
      <input type="email" name="email" class="form-control" placeholder="example@email.com" required>
    </div>

    <div class="mb-3">
      <label class="form-label">ì „í™”ë²ˆí˜¸ *</label>
      <input type="text" name="phone" class="form-control" placeholder="010-1234-5678" required>
    </div>

    <div class="mb-3">
      <label class="form-label">ëŒ€í™”í•˜ê³  ì‹¶ì€ ì£¼ì œ *</label>
      <textarea name="purpose" class="form-control" rows="4" placeholder="ì–´ë–¤ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?" required></textarea>
    </div>

    <button type="submit" class="btn coffee-btn w-100">ë‹¤ìŒ ë‹¨ê³„ (ì´ë©”ì¼ ì¸ì¦)</button>
  </form>

  <div class="text-center mt-3">
    <a href="/" class="text-muted">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
</div>
{% endblock %}

{% block script %}
<style>
  body {
    background-color: #f3ede7;
    font-family: 'Inter', sans-serif;
    color: #5e4634;
  }

  .coffee-card {
    background-color: #fffdfc;
    border-radius: 1rem;
    max-width: 600px;
    margin: 2rem auto;
  }

  .coffee-btn {
    background-color: #6b4c3b;
    color: white;
    border: 1px solid #6b4c3b;
    transition: all 0.2s ease-in-out;
  }

  .coffee-btn:hover {
    background-color: #f3ede7;
    color: #6b4c3b;
    border: 1px solid #6b4c3b;
  }

  .form-control:focus {
    border-color: #c5a990;
    box-shadow: 0 0 0 0.2rem rgba(197, 169, 144, 0.25);
  }

  textarea.form-control {
    resize: vertical;
  }

  #timer-alert.expired {
    background-color: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
  }
</style>

<script>
// ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸
const expiresAt = new Date("{{ expires_at }}");

function updateCountdown() {
  const now = new Date();
  const diff = expiresAt - now;

  if (diff <= 0) {
    document.getElementById('countdown').textContent = 'ë§Œë£Œë¨';
    document.getElementById('timer-alert').classList.add('expired');
    document.querySelector('button[type="submit"]').disabled = true;

    // 3ì´ˆ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ë§Œë£Œ ë©”ì‹œì§€ í‘œì‹œ)
    setTimeout(() => {
      window.location.reload();
    }, 3000);
    return;
  }

  const minutes = Math.floor(diff / 60000);
  const seconds = Math.floor((diff % 60000) / 1000);

  document.getElementById('countdown').textContent =
    `${minutes}ë¶„ ${seconds}ì´ˆ`;

  // 1ë¶„ ë¯¸ë§Œ ì‹œ ë¹¨ê°„ìƒ‰
  if (minutes < 1) {
    document.getElementById('timer-alert').classList.add('expired');
  }
}

// ì´ˆê¸° ì‹¤í–‰ ë° 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
updateCountdown();
setInterval(updateCountdown, 1000);
</script>
{% endblock %}
