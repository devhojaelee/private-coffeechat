{% extends "base.html" %}

{% block title %}ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ | TALK IF INVITED{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>ğŸ“‹ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡</h2>
 <form method="post" action="{{ url_for('admin_logout') }}" onsubmit="return confirmLogout();">
  <button type="submit" class="btn btn-outline-danger btn-sm">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
</form>
</div>

{% for r in reservations %}
<div class="reservation-card">
  <!-- ê¸°ë³¸ ì •ë³´ í…Œì´ë¸” (PCìš©) -->
  <table class="table table-bordered text-center mb-2 align-middle d-none d-sm-table">
    <thead class="table-dark">
      <tr>
        <th>ID</th><th>ì´ˆëŒ€ì½”ë“œ</th><th>ì´ë¦„</th><th>ì´ë©”ì¼</th><th>ì „í™”ë²ˆí˜¸</th><th>ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ r[0] }}</td>
        <td>{{ r[1] }}</td>
        <td class="text-nowrap">{{ r[2] }}</td>
        <td class="text-nowrap">{{ r[3] }}</td>
        <td class="text-nowrap">{{ r[4] }}</td>
        <td class="text-nowrap">
          {% if r[9] == "ìŠ¹ì¸ë¨" %}
            <span class="badge bg-success">ìŠ¹ì¸ë¨<br><small>{{ r[8] }}</small></span>
          {% elif r[9] == "ê±°ì ˆë¨" %}
            <span class="badge bg-danger">ê±°ì ˆë¨</span>
          {% else %}
            <span class="badge bg-secondary">ëŒ€ê¸° ì¤‘</span>
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ëª¨ë°”ì¼ìš© ê¸°ë³¸ ì •ë³´ ë¶„í•  í…Œì´ë¸” -->
  <table class="table table-bordered text-center mb-2 align-middle d-sm-none">
    <thead class="table-dark">
      <tr><th>ID</th><th>ì´ˆëŒ€ì½”ë“œ</th><th>ì´ë¦„</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ r[0] }}</td>
        <td>{{ r[1] }}</td>
        <td class="text-nowrap">{{ r[2] }}</td>
      </tr>
    </tbody>
  </table>
  <table class="table table-bordered text-center mb-2 align-middle d-sm-none">
    <thead class="table-dark">
      <tr><th>ì´ë©”ì¼</th><th>ì „í™”ë²ˆí˜¸</th></tr>
    </thead>
    <tbody>
      <tr>
        <td class="text-nowrap">{{ r[3] }}</td>
        <td class="text-nowrap">{{ r[4] }}</td>
      </tr>
    </tbody>
  </table>
  <table class="table table-bordered text-center mb-2 align-middle d-sm-none">
    <thead class="table-dark">
      <tr><th>ìƒíƒœ</th></tr>
    </thead>
    <tbody>
      <tr>
        <td class="text-nowrap">
          {% if r[9] == "ìŠ¹ì¸ë¨" %}
            <span class="badge bg-success">ìŠ¹ì¸ë¨<br><small>{{ r[8] }}</small></span>
          {% elif r[9] == "ê±°ì ˆë¨" %}
            <span class="badge bg-danger">ê±°ì ˆë¨</span>
          {% else %}
            <span class="badge bg-secondary">ëŒ€ê¸° ì¤‘</span>
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ì˜ˆì•½ ì‹œê°„ í…Œì´ë¸” -->
  <table class="table table-sm table-bordered mb-2">
    <thead class="table-light">
      <tr><th>ì˜ˆì•½ ì‹œê°„</th></tr>
    </thead>
    <tbody>
      {% for slot in r[6] %}
      <tr><td class="text-nowrap">{{ loop.index }}ï¸âƒ£ {{ slot }}</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% set start_time = r[6]|sort|first %}
  {% set end_time = r[6]|sort|last %}
  {% set start_hour = start_time[11:13]|int %}
  {% set start_minute = start_time[14:16]|int %}
  {% set end_hour = end_time[11:13]|int %}
  {% set end_minute = end_time[14:16]|int + 30 %}
  {% if end_minute >= 60 %}
    {% set end_hour = end_hour + 1 %}
    {% set end_minute = end_minute - 60 %}
  {% endif %}
  {% set slot_count = r[6]|length %}
  {% set total_minutes = slot_count * 30 %}
  {% set total_hours = total_minutes // 60 %}
  {% set remain_minutes = total_minutes % 60 %}

  <p class="text-end text-muted small">
    {{ '%02d:%02d' % (start_hour, start_minute) }} ~ {{ '%02d:%02d' % (end_hour, end_minute) }} (ì´
    {% if total_hours > 0 %}{{ total_hours }}ì‹œê°„ {% endif %}
    {% if remain_minutes > 0 or total_hours == 0 %}{{ remain_minutes }}ë¶„{% endif %})
  </p>

  <!-- ëŒ€í™”í•˜ê³  ì‹¶ì€ ì£¼ì œ í…Œì´ë¸” -->
  <table class="table table-sm table-bordered mb-3">
    <thead class="table-light">
      <tr><th>ëŒ€í™”í•˜ê³  ì‹¶ì€ ì£¼ì œ</th></tr>
    </thead>
    <tbody>
      <tr><td>{{ r[5] }}</td></tr>
    </tbody>
  </table>

  <!-- ê´€ë¦¬ ë° ì‚­ì œ ë²„íŠ¼ -->
  <div class="action-buttons">
    <form method="post" onsubmit="return confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
      <input type="hidden" name="approve_id" value="{{ r[0] }}">
      <button type="submit" class="btn btn-sm btn-success">ìŠ¹ì¸</button>
    </form>
    <form method="post" onsubmit="return confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
      <input type="hidden" name="reject_id" value="{{ r[0] }}">
      <button type="submit" class="btn btn-sm btn-warning">ê±°ì ˆ</button>
    </form>
    <form method="post" onsubmit="return confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œí•˜ë©´ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');">
      <input type="hidden" name="remove_id" value="{{ r[0] }}">
      <button type="submit" class="btn btn-sm btn-danger">ì‚­ì œ</button>
    </form>
  </div>
</div>
{% endfor %}

<a href="/" class="btn btn-secondary mt-4">í™ˆìœ¼ë¡œ</a>
{% endblock %}

{% block script %}
<style>
  .reservation-card {
    border: 2px solid #dee2e6;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    background-color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
  .action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
  }
  @media (max-width: 576px) {
    .table th, .table td {
      font-size: 0.85rem;
      padding: 0.3rem;
    }
    .reservation-card {
      padding: 1rem;
    }
  }
</style>

<script>
function confirmLogout() {
    return confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
  }
  // âœ… 10ë¶„ í›„ ìë™ ë¡œê·¸ì•„ì›ƒ (indexë¡œ ì´ë™)
  setTimeout(function () {
    alert("ì„¸ì…˜ì´ ë§Œë£Œë˜ì–´ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤.");
    window.location.href = "{{ url_for('home') }}";
  }, 600000); // 600,000ms = 10ë¶„
</script>
{% endblock %}